#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>

/* source: https://www.cs.utexas.edu/~shmat/courses/cs380s_fall09/blexim.txt */

// try launching with argv[1]=65615
int main(int argc, char ** argv)  {
    uint8_t s;
    int32_t len;
    char buf[80];

    if (argc < 2) {
        return -1;
    }

    len = atoi(argv[1]);
    /****
     * When this value is transferred into the short integer s, it is
     * truncated if the value is too great to fit into s (i.e. if the value is
     * greater than 65535).  Because of this, it is possible to bypass the bounds
     * check at [w1] and overflow the buffer.
    ****/
    s = len;

    if (s >= 80) {
        printf("s too long\n");
        return -1;
    }

    printf("s=%d, len=%d\n",s, len);

    for (int i=0; i<len; ++i)  {
        buf[i] = 'h';
        // code doing some (seemingly non-malicious) stuff
    }

    return 0;
}